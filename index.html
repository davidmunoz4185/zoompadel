<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Zoom Pádel WPT</title>
  <link rel="stylesheet" href="./css/bootstrap.min.css">
  <link rel="stylesheet" href="./css/keen-dashboards.css">
  <link rel="stylesheet" href="./css/dc.css">
  <link rel="stylesheet" href="./css/custom.css">
</head>
<body >

  <header class="text-center" id="header">
    <h1>WPT- Resumen Temporada 2015 - Torneos</h1>
  </header>

  <div class="container-fluid text-center">

    <div class="row">
      <div class="col-sm-4" id="topTitles">
        TORNEOS
      </div>
      <div class="col-sm-4" id="topTitles">
        PARTIDOS
      </div>
      <div class="col-sm-4" id="topTitles">
        RATIO PARTIDOS / TORNEO
      </div>
    <div class="row">
      <div class="col-sm-4">
        <div class="row text-center">
          <div class="col-sm-4 text-right" id="topNumbers">
            <h7 id="numberChart"></h7>
            <h7> Tipos de Torneo</h7>
          </div>
          <div class="col-sm-4" id="topNumbers">
            <h7 id="numberChart2"></h7>
            <h7>
              Torneos
            </h7>
          </div>
          <div class="col-sm-4" id="topNumbers">
            <h7 id="numberChart3"></h7>
            <h7>
               Torneos / Género
            </h7>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12 text-center" id="titleChart">
              <h7>
                Porcentaje y Nº de Torneos por Tipo de Torneo
              </h7>
            <hr>
          </div>
        </div>
        <div class="row" id="rowCharts">
          <div class="col-sm-6" id="pieChart">
            <!--Chart 1.1 -->
          </div>
          <div class="col-sm-6" id="rowChart">
            <!--Chart 1.2 -->
          </div>
        </div>
        <div class="row" id="title2">
          <div class="col-sm-9 text-center" id="titleChart">
            Nº de Torneos por tipo de Torneo y Género
          </div>
          <div class="col-sm-3" id="rowChart4">
            <!--Chart 1.3-->
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <hr>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            Chart 1.4
          </div>
        </div>
      </div>

      <div class="col-sm-4">
        <div class="row">
          <div class="col-sm-12" id="topNumbers">
            <h7 id="numberChart4"></h7> 
            <h7>Partidos</h7> 
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12 text-center" id="titleChart">
            Porcentaje y Nº de Partidos por Tipo de Torneo
            <hr>
          </div>
        </div>
        <div class="row" id="rowCharts">
          <div class="col-sm-6" id="pieChart2">
            <!--Chart 2.1 -->
          </div>
          <div class="col-sm-6" id="rowChart2">
            <!--Chart 2.2 -->
          </div>
        </div>
        <div class="row" id="title2">
          <div class="col-sm-9 text-center" id="titleChart">
            Nº de Partidos por tipo de Torneo y Género
          </div>
          <div class="col-sm-3" id="rowChart5">
            <!--Chart 2.3 -->
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <hr>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            Chart 2.4
          </div>
        </div>
      </div>

      <div class="col-sm-4">
        <div class="row text-center">
          <div class="col-sm-12" id="topNumbers">
            58 Partidos por Torneo
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12 text-center" id="titleChart">
            Ratio Partidos / Torneo
            <hr>
          </div>
        </div>
        <div class="row" id="rowCharts">
          <div class="col-sm-11" id="rowChart3">
            <!--Chart 3.1 -->
          </div>
        </div>
        <div class="row" id="title2">
          <div class="col-sm-8 text-center" id="titleChart">
            Ratio Partido / Torneo
          </div>
          <div class="col-sm-3" id="rowChart6">
            <!--Chart 3.2 -->
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <hr>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            Chart 3.3
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <script src="./js/jquery.min.js"></script>
  <script src="./js/bootstrap.min.js"></script>
  <script src="./js/queue.js"></script>
  <script src="./js/keen.min.js"></script>
  <script src='./js/graphs.js' type='text/javascript'></script>
  <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
  <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.7/crossfilter.min.js"></script>
  <script type="text/javascript" src="./js/d3.tip.js"></script>
  <script type="text/javascript" src="http://dc-js.github.io/dc.js/js/dc.js"></script>
  <script type="text/javascript">

    'use strict';

    var numTipoTorneos  = dc.numberDisplay("#numberChart");
    var numTorneos      = dc.numberDisplay("#numberChart2");
    var numTorneosGen   = dc.numberDisplay("#numberChart3");
    var numPartidos     = dc.numberDisplay("#numberChart4");
    var pieChart        = dc.pieChart("#pieChart");
    var rowChart        = dc.rowChart("#rowChart");
    var pieChart2       = dc.pieChart("#pieChart2");
    var rowChart2       = dc.rowChart("#rowChart2");
    var rowChart3       = dc.rowChart("#rowChart3");
    var rowChart4       = dc.rowChart("#rowChart4");
    var rowChart5       = dc.rowChart("#rowChart5");
    var rowChart6       = dc.rowChart("#rowChart6");
    //var rowChart7       = dc.rowChart("#rowChart7");

    d3.csv("ZOOMPADEL_WPT_TORNEOS.csv", function(error, experiments) {

      var tip = d3.tip()
                  .attr('class', 'd3-tip')
                  .offset([-10, 0])
                  .html(function(d){
                    if(typeof d.value.id_count === "undefined"){
                      return "<strong>" + d.key + ":</strong> <span style='color:red'>" + d.value + "</span>";
                    }
                    else{
                     return "<strong>" + d.key + ":</strong> <span style='color:red'>" + d.value.id_count + "</span>"; 
                    }
      })

      var pieTip = d3.tip()
                  .attr("class", "d3-tip")
                  .offset([-10, 0])
                  .html(function(d) {
                  return "<strong>" + d.data.key + ":</strong> <span style='color:red'>" + d.value + "</span>";
      })

      var ndx                 = crossfilter(experiments);
      var all                 = ndx.groupAll();
      var dimTipoTorneo       = ndx.dimension(function(d) {return d['Tipo Torneo'];});
      var dimTipoTorneoFil    = ndx.dimension(function(d) {if(d['Flag Exento Partido']==0) return d['Tipo Torneo'];});
      var groupTipoTorneoFil  = dimTipoTorneoFil.group();
      var dimGenero           = ndx.dimension(function(d) {if(d['Género Partido'] === 'F'){return "Fem";}else {return "Mas";}});
      var dimTorneos          = ndx.dimension(function(d) {return d['Torneo'];});
      var dimTorneosByGen     = ndx.dimension(function(d) {return d['Torneo'] + d['Género Partido'];});
      var dimFlagPartido      = ndx.dimension(function(d) {return d['Flag Exento Partido'];});
      dimFlagPartido.filter(0);
      var dimPartidoTorneo    = ndx.dimension(function(d) {return d['Tipo Torneo'];});
      var groupPartidoTorneo  = dimPartidoTorneo.group();
      var groupFlagPartido    = dimFlagPartido.group();
      var groupDimTorneos     = dimTorneos.group();
      var groupTorneosByGen   = dimTorneosByGen.group();
      var groupTipoTorneo     = dimTipoTorneo.group();
      var groupDimTipoTorneo  = dimTipoTorneo.group().reduce(
          function (p, d) {
            if(d.Torneo in p.Torneos){
                p.Torneos[d.Torneo] += 1
                //console.log(d.Torneo);
            }
            else{
                p.Torneos[d.Torneo] = 1;
                p.id_count++;
            }
            p.count++;
            return p;
        },

        function (p, d) {
            p.Torneos[d.Torneo]--;
            if(p.Torneos[d.Torneo] === 0){
                delete p.Torneos[d.Torneo];
                p.id_count--;
            }
            return p;
        },

        function () {
                return {Torneos: {},
                id_count: 0,
                count: 0};
            }
      );

      var groupTorneosByGen_v2 = dimGenero.group().reduce(
          function (p, d) {
            if(d.Torneo in p.Torneos){
                p.Torneos[d.Torneo] += 1
                //console.log(d.Torneo);
            }
            else{
                p.Torneos[d.Torneo] = 1;
                p.id_count++;
            }
            p.count++;
            return p;
        },

        function (p, d) {
            p.Torneos[d.Torneo]--;
            if(p.Torneos[d.Torneo] === 0){
                delete p.Torneos[d.Torneo];
                p.id_count--;
            }
            return p;
        },

        function () {
                return {Torneos: {},
                id_count: 0,
                count: 0};
            }
      );

      var groupTorneosByGen_v3 = dimGenero.group().reduce(
          function (p, d) {
            if(d['Flag Exento Partido'] === 0 && d['Flag Exento Partido'] in p.Torneos){
                p.Torneos[d.Torneo] += 1
                //console.log(d.Torneo);
            }
            else{
                p.Torneos[d['Flag Exento Partido']] = 1;
                p.id_count++;
            }
            p.count++;
            return p;
        },

        function (p, d) {
            p.Torneos[d['Flag Exento Partido']]--;
            if(p.Torneos[d['Flag Exento Partido']] === 0){
                delete p.Torneos[d['Flag Exento Partido']];
                p.id_count--;
            }
            return p;
        },

        function () {
                return {Torneos: {},
                id_count: 0,
                count: 0};
            }
      );

    function bin_counter(group) {
      return {
          value: function() {
              return group.all().filter(function(kv) {
                 return kv.value > 0;
              }).length;
          }
      };
    }

    numTipoTorneos
      .group(bin_counter(groupTipoTorneo))
      .formatNumber(d3.format("d"))
      .valueAccessor(function (x) {
        return x;
      });
    
    numTorneos
      .group(bin_counter(groupDimTorneos))
      .formatNumber(d3.format("d"))
      .valueAccessor(function (x) {
        return x;
      });

    numTorneosGen
      .group(bin_counter(groupTorneosByGen))
      .formatNumber(d3.format("d"))
      .valueAccessor(function(x) {
        return x;
      });

    numPartidos
      .dimension(dimFlagPartido)
      .formatNumber(d3.format("d"))
      .group(groupFlagPartido);

    pieChart
      .slicesCap(100)
      .innerRadius(60)
      .dimension(dimTipoTorneo)
      .group(groupDimTipoTorneo) 
      .valueAccessor(function (d) {
          return d.value.id_count;
      })
      .title(function(d){
          return d.value.id_count;
      })
      .renderLabel(false)
      .legend(dc.legend().x(80).y(65).itemHeight(13).gap(5));

    rowChart
    .group(groupDimTipoTorneo)
    .dimension(dimTipoTorneo)
    .margins({top: 0, right: 0, bottom: -1, left: 0})
    .valueAccessor(function (d) {
      return d.value.id_count;
    })
    .elasticX(false)
    .renderLabel(false)
    .xAxis().ticks(0);

    pieChart2
      .slicesCap(100)
      .innerRadius(60)
      .dimension(dimTipoTorneoFil)
      .group(groupTipoTorneoFil) 
      .renderLabel(false)
      .legend(dc.legend().x(80).y(65).itemHeight(13).gap(5));

    rowChart2
      .dimension(dimTipoTorneoFil)
      .group(groupTipoTorneoFil)
      .margins({top: 0, right: 0, bottom: -1, left: 0})
      .elasticX(true)
      .renderLabel(false)
      .xAxis().ticks(0);

    rowChart3
    .group(groupDimTipoTorneo)
    .dimension(dimTipoTorneo)
    .margins({top: 0, right: 0, bottom: -1, left: 0})
    .valueAccessor(function (d) {
      return d.value.id_count;
    })
    .elasticX(true)
    .renderLabel(false)
    .xAxis().ticks(0);

    rowChart4
    .width(100)
    .height(25)
    .dimension(dimGenero)
    .group(groupTorneosByGen_v2)
    .margins({top: 0, right: 0, bottom: -1, left: 0})
    .valueAccessor(function (d) {
      return d.value.id_count;
    })
    .elasticX(true)
    .renderLabel(false)
    .xAxis().ticks(0);

    rowChart5
    .width(100)
    .height(25)
    .dimension(dimGenero)
    .group(groupTorneosByGen_v3)
    .margins({top: 0, right: 0, bottom: -1, left: 0})
    .valueAccessor(function (d) {
      return d.value.id_count;
    })
    .elasticX(true)
    .renderLabel(false)
    .xAxis().ticks(0);

    rowChart6
    .width(100)
    .height(25)
    .dimension(dimGenero)
    .group(groupTorneosByGen_v3)
    .margins({top: 0, right: 0, bottom: -1, left: 0})
    .valueAccessor(function (d) {
      return d.value.id_count;
    })
    .elasticX(true)
    .renderLabel(false)
    .xAxis().ticks(0);
      
    dc.renderAll();

    d3.selectAll("g.row").call(tip);
    d3.selectAll("g.row").on('mouseover', tip.show)
    .on('mouseout', tip.hide);

    d3.selectAll(".pie-slice").call(pieTip);
    d3.selectAll(".pie-slice").on('mouseover', pieTip.show)
    .on('mouseout', pieTip.hide);

  });
  </script>
</body>
</html>
